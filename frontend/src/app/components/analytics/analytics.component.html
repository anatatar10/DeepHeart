<div class="analytics-container">
  <!-- Header -->
  <div class="section-header">
    <h2>Analytics & Reporting</h2>
    <p class="section-subtitle">Performance insights and model metrics</p>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="loading-spinner"></div>
    <p>Loading analytics data...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="error-container">
    <div class="error-icon">‚ö†Ô∏è</div>
    <h3>Unable to Load Analytics</h3>
    <p>{{ error }}</p>
    <button class="btn btn--primary" (click)="loadAnalyticsData()">Try Again</button>
  </div>

  <!-- Analytics Content -->
  <div *ngIf="analyticsData && !loading" class="analytics-content">

    <!-- Key Metrics Cards -->
    <div class="metrics-grid">
      <div class="metric-card">
        <div class="metric-icon">üìä</div>
        <div class="metric-content">
          <h3>{{ analyticsData.totalProcessedThisMonth | number }}</h3>
          <p>Total Processed This Month</p>
        </div>
      </div>

      <div class="metric-card">
        <div class="metric-icon">üéØ</div>
        <div class="metric-content">
          <h3>{{ analyticsData.modelPerformance.accuracy }}%</h3>
          <p>Model Accuracy</p>
        </div>
      </div>

      <div class="metric-card">
        <div class="metric-icon">‚ö°</div>
        <div class="metric-content">
          <h3>{{ analyticsData.averageProcessingTime }}s</h3>
          <p>Avg Processing Time</p>
        </div>
      </div>

      <div class="metric-card">
        <div class="metric-icon">üìà</div>
        <div class="metric-content">
          <h3>{{ analyticsData.modelPerformance.auc }}%</h3>
          <p>AUC Score</p>
        </div>
      </div>
    </div>

    <!-- Charts Grid -->
    <div class="charts-grid">

      <!-- Classification Distribution -->
      <div class="chart-card">
        <div class="chart-header">
          <h3>Classification Distribution</h3>
          <p>Distribution of ECG classifications over time</p>
        </div>
        <div class="chart-container">
          <canvas #distributionChart></canvas>
        </div>
      </div>

      <!-- Weekly Trends -->
      <div class="chart-card">
        <div class="chart-header">
          <h3>Weekly Upload Trends</h3>
          <p>ECG uploads over the past week</p>
        </div>
        <div class="chart-container">
          <canvas #trendsChart></canvas>
        </div>
      </div>

      <!-- Model Performance -->
      <div class="performance-card">
        <div class="chart-header">
          <h3>Model Performance</h3>
          <p>Current model metrics and statistics</p>
        </div>
        <div class="performance-grid">
          <div class="performance-metric">
            <div class="metric-label">Accuracy</div>
            <div class="metric-value">{{ analyticsData.modelPerformance.accuracy }}%</div>
            <div class="metric-bar">
              <div class="metric-fill" [style.width.%]="analyticsData.modelPerformance.accuracy"></div>
            </div>
          </div>

          <div class="performance-metric">
            <div class="metric-label">AUC</div>
            <div class="metric-value">{{ analyticsData.modelPerformance.auc }}%</div>
            <div class="metric-bar">
              <div class="metric-fill" [style.width.%]="analyticsData.modelPerformance.auc"></div>
            </div>
          </div>

          <div class="performance-metric">
            <div class="metric-label">Sensitivity</div>
            <div class="metric-value">{{ analyticsData.modelPerformance.sensitivity }}%</div>
            <div class="metric-bar">
              <div class="metric-fill" [style.width.%]="analyticsData.modelPerformance.sensitivity"></div>
            </div>
          </div>

          <div class="performance-metric">
            <div class="metric-label">Specificity</div>
            <div class="metric-value">{{ analyticsData.modelPerformance.specificity }}%</div>
            <div class="metric-bar">
              <div class="metric-fill" [style.width.%]="analyticsData.modelPerformance.specificity"></div>
            </div>
          </div>
        </div>

        <div class="performance-footer">
          <small>Last Updated: {{ formatLastUpdated(analyticsData.modelPerformance.lastUpdated) }}</small>
        </div>
      </div>

      <!-- Export Options -->
      <div class="export-card">
        <div class="chart-header">
          <h3>Export Reports</h3>
          <p>Download detailed analytics and reports</p>
        </div>
        <div class="export-options">
          <button class="btn btn--outline btn--full-width" (click)="exportAnalyticsReport()">
            üìä Download Analytics Report
          </button>
          <button class="btn btn--outline btn--full-width" (click)="exportPatientData()">
            üìã Export Patient Data
          </button>
          <button class="btn btn--outline btn--full-width" (click)="exportModelPerformance()">
            üìà Model Performance Report
          </button>
        </div>
      </div>
    </div>

    <!-- Detailed Classification Breakdown -->
    <div class="classification-breakdown">
      <h3>Classification Breakdown</h3>
      <div class="classification-grid">
        <div class="classification-item" *ngFor="let item of getClassificationItems()">
          <div class="classification-color" [style.background-color]="getClassificationColor(item.key)"></div>
          <div class="classification-details">
            <div class="classification-name">{{ item.name }}</div>
            <div class="classification-count">{{ item.value }} cases</div>
            <div class="classification-percentage">{{ item.percentage }}%</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
